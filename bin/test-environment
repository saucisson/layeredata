#! /usr/bin/env bash

set -e

hererocks -r^ --lua=5.1                  lua51
hererocks -r^ --lua=5.2    --compat=all  lua52c
hererocks -r^ --lua=5.2    --compat=none lua52
hererocks -r^ --lua=5.3    --compat=all  lua53c
hererocks -r^ --lua=5.3    --compat=none lua53
hererocks -r^ --luajit=2.0 --compat=none luajit20
hererocks -r^ --luajit=2.0 --compat=5.2  luajit20c
hererocks -r^ --luajit=2.1 --compat=none luajit21
hererocks -r^ --luajit=2.1 --compat=5.2  luajit21c

for dir in lua*; do
  "${dir}/bin/luarocks" install luasec
  "${dir}/bin/luarocks" install luacheck
  "${dir}/bin/luarocks" install busted
  "${dir}/bin/luarocks" install luacov
  "${dir}/bin/luarocks" install luacov-coveralls
  "${dir}/bin/luarocks" install compat52 || true
done
